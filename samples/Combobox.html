<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-type" content="text/html; charset=utf-8"/>
	<meta name="viewport"
		content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no"/>
	<meta name="apple-mobile-web-app-capable" content="yes"/>
	<title>Combobox</title>

	<link rel="stylesheet" href="../../delite/themes/defaultapp.css">

	<script type="text/javascript" src="../../requirejs/require.js"></script>

	<script type="text/javascript">
		require.config({
			baseUrl: "../.."
		});
	</script>

	<script type="text/javascript">
		require([
			"deliteful/list/List",
			"dstore/Request",
			"deliteful/Combobox",
			"deliteful/Button",
			"deliteful/RadioButton",
			"deliteful/Checkbox",
			"delite/theme!delite/themes/{{theme}}/global.css",	// page level CSS
			"requirejs-domready/domReady!"
		], function (List, Request) {

			startsWith.on("change", function () {
				comboTeams.filterMode = "startsWith";
			});
			contains.on("change", function () {
				comboTeams.filterMode = "contains";
			});
			is.on("change", function () {
				comboTeams.filterMode = "is";
			});
			ignoreCase.on("change", function () {
				comboTeams.ignoreCase = ignoreCase.checked;
			});

			var items = [
				{ "label": "France", "world-cup-victories": 1, "region": "EU" },
				{ "label": "Germany", "world-cup-victories": 4, "region": "EU" },
				{ "label": "Spain", "world-cup-victories": 1, "region": "EU" },
				{ "label": "Italy", "world-cup-victories": 4, "region": "EU" },
				{ "label": "England", "world-cup-victories": 1, "region": "EU" },
				{ "label": "USA", "world-cup-victories": 0, "region": "America" },
				{ "label": "Canada", "world-cup-victories": 0, "region": "America" },
				{ "label": "Brazil", "world-cup-victories": 5, "region": "America" },
				{ "label": "Argentina", "world-cup-victories": 2, "region": "America" },
				{ "label": "Uruguay", "world-cup-victories": 2, "region": "America" },
				{ "label": "China", "world-cup-victories": 0, "region": "Asia" },
				{ "label": "Japan", "world-cup-victories": 0, "region": "Asia" }
			];

			comboTeams.list.source = comboTeams2.list.source = comboTeams3.list.source = items;

			// custom filter function.
			var filter = function (filterTxt) {
				if(filterTxt.length !== 0) {
					if (this.filterMode === "startsWith") {
						filterTxt = "^" + filterTxt;
					} else if (this.filterMode === "is") {
						filterTxt = "^" + filterTxt + "$";
					}
					var queryListener = this.list.on("query-success", function () {
						this.openDropDown();
						queryListener.remove(queryListener);
					}.bind(this));
					this.list.query = {regExp: filterTxt, ignoreCase: this.ignoreCase};
				} else {
					this.closeDropDown();
				}
			};

			var requestStore = new Request({target: "/foo"});
			var requestStore2 = new Request({target: "/foo"});

			var list = new List({
				righttextAttr: "world-cup-victories",
				categoryAttr: "region",
				showNoItems: true,
				source: requestStore
			});

			var list2 = new List({
				righttextAttr: "world-cup-victories",
				categoryAttr: "region",
				showNoItems: true,
				source: requestStore2
			});

			comboTeamsAutoComplete.filter = comboTeamsAutoComplete2.filter = filter;
			comboTeamsAutoComplete.list = list;
			comboTeamsAutoComplete2.list = list2;


			showResults = function () {
				var getSelectedItemsTxt = function (combobox) {
					var res = "", noOptionSelected = "no option selected";
					if (combobox.selectionMode === "single") {
						res = combobox.value ? combobox.value : noOptionSelected;
					} else { // selectionMode === "multiple"
						var list = combobox.list;
						var n = list.selectedItems.length;
						for (var i = 0; i < n; i++) {
							res += "\n  " + list.selectedItems[i].label;
						}
						if (n === 0) {
							res = noOptionSelected;
						}
					}
					return res;
				};
				alert("Thanks for filling the form!\n" +
					"Your favorite team: " + getSelectedItemsTxt(comboTeams) +
					"\nYour favorite players: " + getSelectedItemsTxt(comboPlayers));
			};

			document.body.style.display = "";
		});
	</script>

	<style>
	html {
		margin: 5px;
	}
	</style>
</head>
<body style="display: none">

	<br/>
	<b>World Cup Survey</b>
	<br/><br/>
	<p>
		<label for="comboTeams-input">Your favorite team (single choice):</label>
	</p>
	<d-combobox selectionMode="single" autoFilter="true" id="comboTeams" preSetValue="false">
		<d-list righttextAttr="world-cup-victories" categoryAttr="region" showNoItems="true">
		</d-list>
	</d-combobox>
	<p>(The number of cups is indicated for each country.)</p>
	<fieldset>
		<legend>Filtering options</legend>
		<d-radio-button name="radio" id="startsWith" checked="true"></d-radio-button>
		<label for="startsWith-input">startsWith</label>
		<d-radio-button name="radio" id="contains" checked="false"></d-radio-button>
		<label for="contains-input">contains</label>
		<d-radio-button name="radio" id="is" checked="false"></d-radio-button>
		<label for="is-input">is</label>
		<d-checkbox id="ignoreCase" checked></d-checkbox>
		<label for="ignoreCase-input">Ignore Case</label>
	</fieldset>
	<br/>

	<p>
	<label for="comboTeams2-input">Your favorite team (single choice)</label><br/>
	<span>[hasDownArrow:false, openOnPointerDown:false, filterDelay:1000ms]</span>
	</p>
	<d-combobox selectionMode="single" autoFilter="true" id="comboTeams2" preSetValue="false" hasDownArrow="false" openOnPointerDown="false" filterDelay="1000">
		<d-list righttextAttr="world-cup-victories" categoryAttr="region" showNoItems="true">
		</d-list>
	</d-combobox>

	<br/>

	<p>
	<label for="comboTeams3-input">Your favorite team (single choice)</label><br/>
	<span>[hasDownArrow:false, openOnPointerDown:false, filterDelay:1000ms, nodeToFocus: "inputNode" (mobile only)]</span>
	</p>
	<d-combobox selectionMode="single" autoFilter="true" id="comboTeams3" preSetValue="false" hasDownArrow="false" openOnPointerDown="false" filterDelay="1000" nodeToFocus="inputNode">
		<d-list righttextAttr="world-cup-victories" categoryAttr="region" showNoItems="true">
		</d-list>
	</d-combobox>

	<br/>

	<p>
	<label for="comboPlayers-input">Your favorite players (multiple choice):</label>
	</p>
	<d-combobox selectionMode="multiple" id="comboPlayers" autoFilter="true">
		<d-list>
			{ "label": "Zidane" },
			{ "label": "Platini" },
			{ "label": "Maradona" },
			{ "label": "Hagi" },
			{ "label": "Buffon" }
		</d-list>
	</d-combobox>

	<p>
	<button is="d-button" onclick="showResults()">Done</button>
	</p>

	<h4>The below are using a `dStore/Request` store and a custom filter function.</h4>

	<p>
	<label for="comboTeamsAutoComplete-input">Your favorite team (single choice)</label><br/>
	<span>[hasDropDown:false, openOnPointerDown:true, source: Request, filterDelay:500m]</span>
	</p>
	<d-combobox selectionMode="single" autoFilter="true" preSetValue="false" hasDownArrow="false" filterDelay="500" id="comboTeamsAutoComplete" openOnPointerDown="true">
	</d-combobox>

	<br/>

	<p>
	<label for="comboTeamsAutoComplete2-input">Your favorite team (single choice)</label><br/>
	<span>[hasDropDown:false, openOnPointerDown:false, source: Request, filterDelay:500ms]</span>
	</p>
	<d-combobox selectionMode="single" autoFilter="true" preSetValue="false" hasDownArrow="false" filterDelay="500" id="comboTeamsAutoComplete2" openOnPointerDown="false">
	</d-combobox>

	<br/>

</body>
</html>
